---
import Layout from "../layouts/Layout.astro";
---

<Layout>
  <div class="hero">
    <div class="content">
      <h1 class="title"></h1>
      <div class="card">
        <img class="user-photo" />
        <form id="create-user-form">
          <label for="username">Username</label>
          <input type="text" id="username" />
          <button>Create user</button>
        </form>
      </div>
    </div>
  </div>

  <style>
    .hero {
      width: 100%;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      background-color: var(--White_Light);
    }

    .content{
        width: 400px;
        height: 400px;
        display: flex;
        align-items: center;
        flex-direction: column;
        justify-content: center;
        background-color: var(--White);
        box-shadow: 0 0 5px var(--Black_light);
        border-radius: 24px;
    }

    img{
        width: 150px;
        height: 150px;
        border-radius: 100%;
    }
    h1{
        margin: 0;
        margin-bottom: 20px;
    }

    button{
      background-color: var(--blue);
      border: transparent;
      padding: 10px 20px;
      font-size: 1rem;
      border-radius: 4px;
    }

    .card{
        width: 50%;
        height: 70%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    form{
        width: 100%;
        height: 120px;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        margin-top: 20px;
    }

    label{
        font-size: 1.3rem;
        font-weight: 600;
        background-color: var(--White);
        transform: translateY(20px);
    }

    input{
        width: 100%;
        height: 30px;
        text-align: center;
        margin: 10px 0;
        border-radius: 4px;
      border: 1px solid var(--Black);

    }

    input:focus{
      outline: none;

    }
  </style>

  <script>
    import { auth, db } from "../firebase";
    import { onAuthStateChanged } from "firebase/auth";
    import { doc, setDoc } from "firebase/firestore";

    onAuthStateChanged(auth, async (user) => {

        console.log(user)

      const photo = document.querySelector(".user-photo");
      const titlePage = document.querySelector(".title");
      const form = document.getElementById("create-user-form");
      const usernameInput = document.getElementById("username");

      photo.src = user?.photoURL;
      titlePage.textContent = user?.displayName;

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        try {
          await setDoc(doc(db, "users", user.uid), {
            uid: user.uid,
            email: user.email,
            name: user.displayName,
            username: usernameInput.value,
            photoURL: user.photoURL,
            createdAt: new Date(),
          });

          // Redirigir al dashboard
          window.location.href = "/Folders";
        } catch (error) {
          console.error("Error creando el usuario:", error);
        }
      });
    });
  </script>
</Layout>
